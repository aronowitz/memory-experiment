sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
m1
out1 = makeCovs(20, 3, 2)
out1
m1 = makeMod(out1, fixed, rand[1])
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
out1
out1 = makeCovs(40, 3, 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
params(4)
fixed = params(4)
# makeCovs: create data frame of covariates
makeCovs <- function(n, time, treat = 3, classes = NULL){
stopifnot(length(n) == 1); stopifnot(is.numeric(n))
stopifnot(length(time) == 1); stopifnot(is.numeric(time))
if(length(treat) == 1 & is.numeric(treat)){treat <- LETTERS[1:treat]}
stopifnot(!is.numeric(treat))
k <- n/length(treat)
while(!identical(k, round(k))){
n <- n + 1
k <- n/length(treat)
}
id <- factor(1:n)
time <- factor(1:time)
id2 <- rep(id, length(time))
time2 <- rep(time, each = length(id))
treat2 <- rep(rep(treat, each = k), length(time))
covs <- data.frame(id = id2, treat = treat2, time = time2)
if(!is.null(classes)){
if(length(classes) == 1 & is.numeric(classes)){
classes <- letters[1:classes]
}
if(!is.numeric(classes)){
kk <- length(classes)
classes <- rep(classes, each = nrow(covs))
covs <- data.frame(id = rep(id2, kk), class = classes,
treat = rep(treat2, kk),
time = rep(time2, kk))
covs <- covs[order(covs$time), ]
rownames(covs) <- 1:nrow(covs)
}
}
covs
}
out1 = makeCovs(20, 4, 3)
out1
m1 = makeMod(out1, fixed, list(.5), 2)
head(out1)
fixe
fixed
levels(out1$treat)
names(fixed) = NULL
m1 = makeMod(out1, fixed, list(.5), 2)
m1
# makeMod
makeMod <- function(data, fixed, rand, sigma = 2, form = 'default'){
cols <- c('id', 'treat', 'time')
colnames(data) <- tolower(colnames(data))
stopifnot(all(cols %in% colnames(data)))
if(identical(form, 'default')){
form0 <- 'y ~ treat * time + (1|'
form1 <- ifelse(ncol(data) > 3, 'class/id', 'id')
form <- paste0(form0, form1, ')')
}
form <- as.formula(form)
names(fixed) <- NULL; names(rand) <- NULL
out <- simr::makeLmer(formula = form, fixef = fixed,
VarCorr = rand, sigma = sigma,
data = data)
return(out)
}
fixed = params(4)
m1 = makeMod(out1, fixed, list(.5), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
out1
out1 = makeCovs(10, 3, 2, 5)
excoefs()
fixed
fixed2 = fixed
fixed2[1] = 0
fixed2
m1 = makeMod(out1, fixed, rand, 2)
m2 = makeMod(out1, fixed2, rand, 2)
set.seed(1)
sim1 = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim1
set.seed(1)
sim2 = powerSim(m2, nsim = 100, test = fcompare(y ~ time))
sim2
fixed
fixed[2] = .5
rmall()
source('~/R/simr/powerFunctions.R')
params(T)
m1 = makeMod(data, fixed, rand, 2)
set.seed91
set.seed(1)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
fixed <- params(4)
out1 <- makeCovs(100, 4)
sim
m1 = makeMod(out1, fixed, list(.5), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
fixed <- params(4)
out1 <- makeCovs(100, 4, classes = 4)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
out1 <- makeCovs(30, 4, classes = 4)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
fixed
out1
subset(out1, class == 'A')
head(out1)
subset(out1, class == 'a')
k = subset(out1, class == 'a')
count(k$time)
fixed
fixed = rep(.2, 12)
out1 <- makeCovs(30, 4, classes = 4)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
fixed = rep(.4, 12)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
fixed <- params(4)
out1 <- makeCovs(30, 4, classes = 4)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
sim
out1
fixed
fixed = rep(.4, 12)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
out1 <- makeCovs(50, 4, classes = 4)
m1 = makeMod(out1, fixed, list(.5, .1), 2)
sim = powerSim(m1, nsim = 100, test = fcompare(y ~ time))
sim
out1
dim(subset(out1, class == 'a'))
dim(subset(out1, class == 'a'))/4
subset(out1, class == 'a')
subset(out1, class == 'a' & time == 1)
dim(subset(out1, time == 1))
out1
k = subset(out1, time == 1)
count(k$treat)
68 * 3
200/3
### SIMPLE RANDOMIZATION
set.seed(888)
treatment <- c('A', 'B')
simple.list <- sample(treatment, 20, replace = TRUE)
cat(simple.list, sep = '\n')
table(simple.list)
library(blockrand)
set.seed(888)
block.list <- blockrand(n = 20, num.levels = 2, block.sizes = c(2, 2))
block.list
block.list2 <- blockrand(n = 20, num.levels = 2, block.sizes = c(1, 2))
block.list2
### STRATIFIED RANDOMIZATION
# Balance in patient characteristics may not be achieved in small studies
# Common strata: age, group, etc.
# Generate randomized list for each stratum
over50.severe.list <- blockrand(n = 100, num.levels = 2,
block.sizes = c(1, 2, 3, 4),
stratum = 'Over 50 Severe',
id.prefix = 'O50_S',
block.prefix = 'O50_S')
over50.severe.list
library(simr)
simr:::glmerSet
setwd('Documents/memory-experiment/DATA/final')
file.edit('finalAnalysis.R')
dir()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
for(i in c('ID', 'session', 'condition')){
sorts[[i]] <- factor(sorts[[i]])
simple[[i]] <- factor(simple[[i]])
}
sorts$correct <- sorts$correct/9
simple$correct <- simple$correct/9
rownames(sorts) <- 1:nrow(sorts)
rownames(simple) <- 1:nrow(simple)
write.csv(sorts, 'fullData.csv', row.names = FALSE)
write.csv(simple, 'simpleData.csv', row.names = FALSE)
### Analysis 1: Simple dataset
if(!require(lme4)){install.packages('lme4', dependencies = TRUE)} # v1.1-19
m1 <- lmer(correct ~ condition + trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m2 <- lmer(correct ~ condition * trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
anova(m1, m2)
dir()
rmall()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
conditions <- c('SpaceSemTime', 'SpaceTime', 'SpaceSem', 'TimeSem', 'Control')
for(i in c('ID', 'session', 'condition')){
sorts[[i]] <- factor(sorts[[i]], levels = conditions)
simple[[i]] <- factor(simple[[i]], levels = conditions)
}
sorts$correct <- sorts$correct/9
simple$correct <- simple$correct/9
head(simple)
rmall()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
### Create datasets:
# Full data: all items, all IDs, all trials, all conditions
# Simple data: all IDs, all trials, all conditions
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
#conditions <- c('SpaceSemTime', 'SpaceTime', 'SpaceSem', 'TimeSem', 'Control')
for(i in c('ID', 'session', 'condition')){
sorts[[i]] <- factor(sorts[[i]])
simple[[i]] <- factor(simple[[i]])
}
rmall()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
### Create datasets:
# Full data: all items, all IDs, all trials, all conditions
# Simple data: all IDs, all trials, all conditions
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
conditions <- c('SpaceSemTime', 'SpaceTime', 'SpaceSem', 'TimeSem', 'Control')
for(i in c('ID', 'session', 'condition')){
if(i != 'condition'){
sorts[[i]] <- factor(sorts[[i]])
simple[[i]] <- factor(simple[[i]])
} else {
sorts[[i]] <- factor(sorts[[i]], levels = conditions)
simple[[i]] <- factor(simple[[i]], levels = conditions)
}
}
head(simple)
rmall()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
### Create datasets:
# Full data: all items, all IDs, all trials, all conditions
# Simple data: all IDs, all trials, all conditions
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
conditions <- c('SpaceSemTime', 'SpaceTime', 'SpaceSem', 'TimeSem', 'Control')
for(i in c('ID', 'session', 'condition')){
sorts[[i]] <- factor(sorts[[i]])
simple[[i]] <- factor(simple[[i]])
}
levels(sorts$condition)
levels(sorts$condition) <- rev(levels(sorts$condition))
levels(sorts$condition)
sorts$condition <- as.numeric(as.character(sorts$condition))
sorts$condition <- factor(sorts$condition)
levels(sorts$condition)
levels(sorts$condition) <- rev(conditions)
rmall()
source('../../extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
sorts <- lapply(out, lapply, getSorts)
sorts$dat1 <- lapply(sorts$dat1, function(z){
z1 <- z[-(1:18), ]
z1$trial <- z1$trial - 2
return(z1)
})
simple <- lapply(sorts, function(z){
k <- seq(1, unique(sapply(z, nrow)), by = 9)
lapply(z, function(i) i[k, 1:3])
})
### Create datasets:
# Full data: all items, all IDs, all trials, all conditions
# Simple data: all IDs, all trials, all conditions
for(i in 1:3){
for(j in 1:length(sorts[[i]])){
sorts[[i]][[j]] <- cbind.data.frame(ID = j, sorts[[i]][[j]])
simple[[i]][[j]] <- cbind.data.frame(ID = j, simple[[i]][[j]])
}
sorts[[i]] <- data.frame(do.call(rbind, sorts[[i]]))
simple[[i]] <- data.frame(do.call(rbind, simple[[i]]))
}
sorts$dat2$trial <- sorts$dat2$trial + 30
simple$dat2$trial <- simple$dat2$trial + 30
sorts$dat3$trial <- sorts$dat3$trial + 60
simple$dat3$trial <- simple$dat3$trial + 60
for(i in 1:3){
sorts[[i]] <- data.frame(ID = sorts[[i]]$ID, session = i, sorts[[i]][, -1])
simple[[i]] <- data.frame(ID = simple[[i]]$ID, session = i, simple[[i]][, -1])
}
sorts <- data.frame(do.call(rbind, sorts))
simple <- data.frame(do.call(rbind, simple))
for(i in c('ID', 'session', 'condition')){
sorts[[i]] <- factor(sorts[[i]])
simple[[i]] <- factor(simple[[i]])
}
conditions <- c('SpaceSemTime', 'SpaceTime', 'SpaceSem', 'TimeSem', 'Control')
levels(sorts$condition) <- rev(levels(sorts$condition))
sorts$condition <- as.numeric(as.character(sorts$condition))
sorts$condition <- factor(sorts$condition)
levels(sorts$condition) <- rev(conditions)
levels(simple$condition) <- rev(levels(simple$condition))
simple$condition <- as.numeric(as.character(simple$condition))
simple$condition <- factor(simple$condition)
levels(simple$condition) <- rev(conditions)
sorts$correct <- sorts$correct/9
simple$correct <- simple$correct/9
rownames(sorts) <- 1:nrow(sorts)
rownames(simple) <- 1:nrow(simple)
head(simple)
levels(sorts$condition)
write.csv(sorts, 'fullData.csv', row.names = FALSE)
write.csv(simple, 'simpleData.csv', row.names = FALSE)
head(sorts)
### Analysis 1: Simple dataset
if(!require(lme4)){install.packages('lme4', dependencies = TRUE)} # v1.1-19
m1 <- lmer(correct ~ condition + trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m2 <- lmer(correct ~ condition * trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
anova(m1, m2)
summary(m1)
library(lsmeans)
lsmeans(m1, pairwise ~ condition, adjust = 'none')
lsmeans(m1, pairwise ~ condition, adjust = 'none')
lsmeans(m1, pairwise ~ condition, adjust = 'tukey')
summary(m1)
lsmeans(m1, pairwise ~ condition, adjust = 'tukey')
lsmeans(m1, pairwise ~ condition, adjust = 'none')
lsmeans(m1, pairwise ~ condition, adjust = 'tukey')
file.edit('../../extractData.R')
lsmeans(m1, pairwise ~ condition, adjust = 'none')
lsmeans(m1, pairwise ~ condition, adjust = 'tukey')
m0 <- lmer(correct ~ condition + (1|ID) + (1|session),
data = simple, REML = FALSE)
m1 <- lmer(correct ~ trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m2 <- lmer(correct ~ condition + trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m3 <- lmer(correct ~ condition * trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m1 <- lmer(correct ~ condition + trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m0 <- lmer(correct ~ condition + (1|ID) + (1|session),
data = simple, REML = FALSE)
m1 <- lmer(correct ~ trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m2 <- lmer(correct ~ condition + trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
m3 <- lmer(correct ~ condition * trial + (1|ID) + (1|session),
data = simple, REML = FALSE)
anova(m0, m2)
anova(m1, m2)
anova(m1, m2)
anova(m0, m2)
anova(m1, m2)
anova(m2, m3) # Are there interactions between trial and condition?
lsmeans(m2, pairwise ~ condition, adjust = 'tukey')
dir()
file.edit('../../extractData.R')
dir()
system('mv ../../extractData.R ./')
dir()
rmall()
source('extractData.R')
out <- getData(getJSONS(), matchPs = TRUE)
